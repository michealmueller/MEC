describe("multiSelect",function(){describe("init",function(){it("should be chainable",function(){select.multiSelect().addClass("chainable");expect(select.hasClass("chainable")).toBeTruthy()});describe("without options",function(){beforeEach(function(){select.multiSelect();msContainer=select.next()});it("should hide the original select",function(){expect(select.css("position")).toBe("absolute");expect(select.css("left")).toBe("-9999px")});it("should create a container",function(){expect(msContainer).toBe("div.ms-container")});it("should create a selectable and a selection container",function(){expect(msContainer).toContain("div.ms-selectable, div.ms-selection")});it("should create a list for both selectable and selection container",function(){expect(msContainer).toContain("div.ms-selectable ul.ms-list, div.ms-selection ul.ms-list")});it("should populate the selectable list",function(){expect($(".ms-selectable ul.ms-list li").length).toEqual(10)});it("should populate the selection list",function(){expect($(".ms-selectable ul.ms-list li").length).toEqual(10)})});describe("with pre-selected options",function(){var a=[];beforeEach(function(){var c=select.children("option").first();var b=select.children("option").last();c.prop("selected",true);b.prop("selected",true);a.push(c.val(),b.val());select.multiSelect();msContainer=select.next()});it("should select the pre-selected options",function(){$.each(a,function(b,c){expect($(".ms-selectable ul.ms-list li#"+sanitize(c)+"-selectable")).toBe(".ms-selected")});expect($(".ms-selectable ul.ms-list li.ms-selected").length).toEqual(2)})});describe("with disabled pre-selected options",function(){var a=["value1","value2","value3"];beforeEach(function(){$("#multi-select").find("option").first().prop("selected",true).prop("disabled",true).next().prop("selected",true).next().prop("selected",true).prop("disabled",true);$("#multi-select").multiSelect()});it("should select the disabled pre-selected options",function(){$.each(a,function(b,c){expect($(".ms-selectable ul.ms-list li#"+sanitize(c)+"-selectable")).toBe(".ms-selected")});expect($(".ms-selectable ul.ms-list li.ms-selected").length).toEqual(3)})});describe("with disabled non-selected options",function(){var a=["value1","value3"];beforeEach(function(){$("#multi-select").find("option").first().prop("selected",true).next().prop("disabled",true).next().prop("selected",true);$("#multi-select").multiSelect()});it("should not select the disabled non-selected options",function(){$.each(a,function(b,c){expect($(".ms-selectable ul.ms-list li#"+sanitize(c)+"-selectable")).toBe(".ms-selected")});expect($(".ms-selectable ul.ms-list li.ms-selected").length).toEqual(2)})})});describe("destroy",function(){describe("destroy multi select",function(){beforeEach(function(){select.multiSelect();msContainer=select.next();select.multiSelect("destroy")});it("should show the original select",function(){expect(select.css("position")).not.toBe("absolute");expect(select.css("left")).not.toBe("-9999px")});it("should destroy the multiSelect container",function(){expect(select.next().size()).toEqual(0)})})});describe("optgroup",function(){var b,c,a;beforeEach(function(){$('<select id="multi-select-optgroup" multiple="multiple" name="testy[]"></select>').appendTo("body");for(var g=1;g<=10;g++){var d=$('<optgroup label="opgroup'+g+'"></optgroup>');for(var e=1;e<=10;e++){var f=e+(g*10);$('<option value="value'+f+'">text'+f+"</option>").appendTo(d)}d.appendTo($("#multi-select-optgroup"))}c=$("#multi-select-optgroup")});describe("init",function(){describe("with selectableOptgroup option set to false",function(){beforeEach(function(){c.multiSelect({selectableOptgroup:false});b=c.next();a=b.find(".ms-selectable .ms-optgroup-label")});it("sould display all optgroups",function(){expect(a.length).toEqual(10)});it("should do nothing when clicking on optgroup",function(){var d=a.first();d.trigger("click");expect(c.val()).toBeNull()})});describe("with selectableOptgroup option set to true",function(){beforeEach(function(){c.multiSelect({selectableOptgroup:true});b=c.next();a=b.find(".ms-selectable .ms-optgroup-label")});it("should select all nested options when clicking on optgroup",function(){var d=a.first();d.trigger("click");expect(c.val().length).toBe(10)})})})});describe("select",function(){describe("multiple values (Array)",function(){var a=["value1","value2","value7"];beforeEach(function(){$("#multi-select").multiSelect();$("#multi-select").multiSelect("select",a)});it("should select corresponding option",function(){expect(select.val()).toEqual(a)})});describe("single value (String)",function(){var a="value1";beforeEach(function(){$("#multi-select").multiSelect();$("#multi-select").multiSelect("select",a)});it("should select corresponding option",function(){expect($.inArray(a,select.val())>-1).toBeTruthy()})});describe("on click",function(){var a,b;beforeEach(function(){$("#multi-select").multiSelect();a=$(".ms-selectable ul.ms-list li").first();b=a.data("ms-value");spyOnEvent(select,"change");spyOnEvent(select,"focus");a.trigger("click")});it("should hide selected item",function(){expect(a).toBeHidden()});it("should add the .ms-selected class to the selected item",function(){expect(a.hasClass("ms-selected")).toBeTruthy()});it("should select corresponding option",function(){expect(select.find('option[value="'+b+'"]')).toBeSelected()});it("should show the associated selected item",function(){expect($("#"+sanitize(b)+"-selection")).toBe(":visible")});it("should trigger the original select change event",function(){expect("change").toHaveBeenTriggeredOn("#multi-select")});afterEach(function(){select.multiSelect("deselect_all")})});describe("on click on disabled non-selected option",function(){var a,b;beforeEach(function(){$("#multi-select").find("option").first().prop("disabled",true);$("#multi-select").multiSelect();a=$(".ms-selectable ul.ms-list li").first();b=a.data("ms-value");spyOnEvent(select,"change");spyOnEvent(select,"focus");a.trigger("click")});it("should not hide selected item",function(){expect(a).not.toBeHidden()});it("should not add the .ms-selected class to the selected item",function(){expect(a.hasClass("ms-selected")).not.toBeTruthy()});it("should not select corresponding option",function(){expect(select.find('option[value="'+b+'"]')).not.toBeSelected()});it("should not show the associated selected item",function(){expect($("#"+sanitize(b)+"-selection")).not.toBe(":visible")});it("should not trigger the original select change event",function(){expect("change").not.toHaveBeenTriggeredOn("#multi-select")});afterEach(function(){select.multiSelect("deselect_all")})})});describe("deselect",function(){describe("multiple values (Array)",function(){var a=["value1","value2","value7"],b=["value1","value2"];beforeEach(function(){$("#multi-select").multiSelect();$("#multi-select").multiSelect("select",a);$("#multi-select").multiSelect("deselect",b)});it("should select corresponding option",function(){expect(select.val()).toEqual(["value7"])})});describe("single value (String)",function(){var a=["value1","value2","value7"],b="value2";beforeEach(function(){$("#multi-select").multiSelect();$("#multi-select").multiSelect("select",a);$("#multi-select").multiSelect("deselect",b)});it("should select corresponding option",function(){expect($.inArray(b,select.val())>-1).toBeFalsy()})});describe("on click",function(){var a,c;var b;beforeEach(function(){$("#multi-select").find("option").first().prop("selected",true);$("#multi-select").multiSelect();a=$(".ms-selection ul.ms-list li").first();c=a.data("ms-value");b=$(".ms-selection ul.ms-list li").first();spyOnEvent(select,"change");spyOnEvent(select,"focus");a.trigger("click")});it("should hide clicked item",function(){expect(a).toBe(":hidden")});it("should show associated selectable item",function(){expect($("#"+sanitize(c)+"-selectable")).toBe(":visible")});it("should remove the .ms-selected class to the corresponding selectable item",function(){expect(b.hasClass("ms-selected")).toBeFalsy()});it("should deselect corresponding option",function(){expect(select.find('option[value="'+c+'"]')).not.toBeSelected()});it("should trigger the original select change event",function(){expect("change").toHaveBeenTriggeredOn("#multi-select")});afterEach(function(){select.multiSelect("deselect_all")})});describe("on click on disabled selected option",function(){var a,c;var b;beforeEach(function(){$("#multi-select").find("option").first().prop("selected",true).prop("disabled",true);$("#multi-select").multiSelect();a=$(".ms-selection ul.ms-list li").first();c=a.data("ms-value");b=$(".ms-selection ul.ms-list li").first();spyOnEvent(select,"change");spyOnEvent(select,"focus");a.trigger("click")});it("should not hide clicked item",function(){expect(a).not.toBe(":hidden")});it("should not show associated selectable item",function(){expect($("#"+c+"-selectable")).not.toBe(":visible")});it("should not remove the .ms-selected class to the corresponding selectable item",function(){expect(b.hasClass("ms-selected")).not.toBeFalsy()});it("should not deselect corresponding option",function(){expect(select.find('option[value="'+c+'"]')).toBeSelected()});it("should not trigger the original select change event",function(){expect("change").not.toHaveBeenTriggeredOn("#multi-select")});afterEach(function(){select.multiSelect("deselect_all")})})})});