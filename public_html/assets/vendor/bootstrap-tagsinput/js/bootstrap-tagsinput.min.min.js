(function(p){var q={tagClass:function(a){return"label label-info"},focusClass:"focus",itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},itemTitle:function(a){return null},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:false,onTagExists:function(a,b){b.hide().fadeIn()},trimValue:false,allowDuplicates:false,triggerChange:true};function l(a,b){this.isInit=true;this.itemsArray=[];this.$element=p(a);this.$element.hide();this.isSelect=(a.tagName==="SELECT");this.multiple=(this.isSelect&&a.hasAttribute("multiple"));this.objectItems=b&&b.itemValue;this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=p('<div class="bootstrap-tagsinput"></div>');this.$input=p('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(b);this.isInit=false}l.prototype={constructor:l,add:function(D,H,A){var C=this;if(C.options.maxTags&&C.itemsArray.length>=C.options.maxTags){return}if(D!==false&&!D){return}if(typeof D==="string"&&C.options.trimValue){D=p.trim(D)}if(typeof D==="object"&&!C.objectItems){throw ("Can't add objects when itemValue option is not set")}if(D.toString().match(/^\s*$/)){return}if(C.isSelect&&!C.multiple&&C.itemsArray.length>0){C.remove(C.itemsArray[0])}if(typeof D==="string"&&this.$element[0].tagName==="INPUT"){var h=(C.options.delimiterRegex)?C.options.delimiterRegex:C.options.delimiter;var G=D.split(h);if(G.length>1){for(var b=0;b<G.length;b++){this.add(G[b],true)}if(!H){C.pushVal(C.options.triggerChange)}return}}var e=C.options.itemValue(D),E=C.options.itemText(D),c=C.options.tagClass(D),f=C.options.itemTitle(D);var g=p.grep(C.itemsArray,function(s){return C.options.itemValue(s)===e})[0];if(g&&!C.options.allowDuplicates){if(C.options.onTagExists){var d=p(".tag",C.$container).filter(function(){return p(this).data("item")===g});C.options.onTagExists(D,d)}return}if(C.items().toString().length+D.length+1>C.options.maxInputLength){return}var B=p.Event("beforeItemAdd",{item:D,cancel:false,options:A});C.$element.trigger(B);if(B.cancel){return}C.itemsArray.push(D);var a=p('<span class="tag '+m(c)+(f!==null?('" title="'+f):"")+'">'+m(E)+'<span data-role="remove"></span></span>');a.data("item",D);C.findInputWrapper().before(a);a.after(" ");var F=(p('option[value="'+encodeURIComponent(e)+'"]',C.$element).length||p('option[value="'+m(e)+'"]',C.$element).length);if(C.isSelect&&!F){var i=p("<option selected>"+m(E)+"</option>");i.data("item",D);i.attr("value",e);C.$element.append(i)}if(!H){C.pushVal(C.options.triggerChange)}if(C.options.maxTags===C.itemsArray.length||C.items().toString().length===C.options.maxInputLength){C.$container.addClass("bootstrap-tagsinput-max")}if(p(".typeahead, .twitter-typeahead",C.$container).length){C.$input.typeahead("val","")}if(this.isInit){C.$element.trigger(p.Event("itemAddedOnInit",{item:D,options:A}))}else{C.$element.trigger(p.Event("itemAdded",{item:D,options:A}))}},remove:function(b,a,c){var d=this;if(d.objectItems){if(typeof b==="object"){b=p.grep(d.itemsArray,function(f){return d.options.itemValue(f)==d.options.itemValue(b)})}else{b=p.grep(d.itemsArray,function(f){return d.options.itemValue(f)==b})}b=b[b.length-1]}if(b){var e=p.Event("beforeItemRemove",{item:b,cancel:false,options:c});d.$element.trigger(e);if(e.cancel){return}p(".tag",d.$container).filter(function(){return p(this).data("item")===b}).remove();p("option",d.$element).filter(function(){return p(this).data("item")===b}).remove();if(p.inArray(b,d.itemsArray)!==-1){d.itemsArray.splice(p.inArray(b,d.itemsArray),1)}}if(!a){d.pushVal(d.options.triggerChange)}if(d.options.maxTags>d.itemsArray.length){d.$container.removeClass("bootstrap-tagsinput-max")}d.$element.trigger(p.Event("itemRemoved",{item:b,options:c}))},removeAll:function(){var a=this;p(".tag",a.$container).remove();p("option",a.$element).remove();while(a.itemsArray.length>0){a.itemsArray.pop()}a.pushVal(a.options.triggerChange)},refresh:function(){var a=this;p(".tag",a.$container).each(function(){var c=p(this),g=c.data("item"),f=a.options.itemValue(g),d=a.options.itemText(g),e=a.options.tagClass(g);c.attr("class",null);c.addClass("tag "+m(e));c.contents().filter(function(){return this.nodeType==3})[0].nodeValue=m(d);if(a.isSelect){var b=p("option",a.$element).filter(function(){return p(this).data("item")===g});b.attr("value",f)}})},items:function(){return this.itemsArray},pushVal:function(){var b=this,a=p.map(b.items(),function(c){return b.options.itemValue(c).toString()});b.$element.val(a,true);if(b.options.triggerChange){b.$element.trigger("change")}},build:function(c){var d=this;d.options=p.extend({},q,c);if(d.objectItems){d.options.freeInput=false}r(d.options,"itemValue");r(d.options,"itemText");k(d.options,"tagClass");if(d.options.typeahead){var f=d.options.typeahead||{};k(f,"source");d.$input.typeahead(p.extend({},f,{source:function(i,g){function v(z){var t=[];for(var y=0;y<z.length;y++){var s=d.options.itemText(z[y]);h[s]=z[y];t.push(s)}g(t)}this.map={};var h=this.map,u=f.source(i);if(p.isFunction(u.success)){u.success(v)}else{if(p.isFunction(u.then)){u.then(v)}else{p.when(u).then(v)}}},updater:function(g){d.add(this.map[g]);return this.map[g]},matcher:function(g){return(g.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(g){return g.sort()},highlighter:function(g){var h=new RegExp("("+this.query+")","gi");return g.replace(h,"<strong>$1</strong>")}}))}if(d.options.typeaheadjs){var b=d.options.typeaheadjs;if(!p.isArray(b)){b=[null,b]}var a=b[1].valueKey;var e=a?function(g){return g[a]}:function(g){return g};p.fn.typeahead.apply(d.$input,b).on("typeahead:selected",p.proxy(function(g,h){d.add(e(h));d.$input.typeahead("val","")},d))}d.$container.on("click",p.proxy(function(g){if(!d.$element.attr("disabled")){d.$input.removeAttr("disabled")}d.$input.focus()},d));if(d.options.addOnBlur&&d.options.freeInput){d.$input.on("focusout",p.proxy(function(g){if(p(".typeahead, .twitter-typeahead",d.$container).length===0){d.add(d.$input.val());d.$input.val("")}},d))}d.$container.on({focusin:function(){d.$container.addClass(d.options.focusClass)},focusout:function(){d.$container.removeClass(d.options.focusClass)}});d.$container.on("keydown","input",p.proxy(function(i){var E=p(i.target),D=d.findInputWrapper();if(d.$element.attr("disabled")){d.$input.attr("disabled","disabled");return}switch(i.which){case 8:if(n(E[0])===0){var h=D.prev();if(h.length){d.remove(h.data("item"))}}break;case 46:if(n(E[0])===0){var g=D.next();if(g.length){d.remove(g.data("item"))}}break;case 37:var C=D.prev();if(E.val().length===0&&C[0]){C.before(D);E.focus()}break;case 39:var F=D.next();if(E.val().length===0&&F[0]){F.after(D);E.focus()}break;default:}var z=E.val().length,B=Math.ceil(z/5),A=z+B+1;E.attr("size",Math.max(this.inputSize,E.val().length))},d));d.$container.on("keypress","input",p.proxy(function(i){var g=p(i.target);if(d.$element.attr("disabled")){d.$input.attr("disabled","disabled");return}var h=g.val(),w=d.options.maxChars&&h.length>=d.options.maxChars;if(d.options.freeInput&&(o(i,d.options.confirmKeys)||w)){if(h.length!==0){d.add(w?h.substr(0,d.options.maxChars):h);g.val("")}if(d.options.cancelConfirmKeysOnEmpty===false){i.preventDefault()}}var x=g.val().length,y=Math.ceil(x/5),z=x+y+1;g.attr("size",Math.max(this.inputSize,g.val().length))},d));d.$container.on("click","[data-role=remove]",p.proxy(function(g){if(d.$element.attr("disabled")){return}d.remove(p(g.target).closest(".tag").data("item"))},d));if(d.options.itemValue===q.itemValue){if(d.$element[0].tagName==="INPUT"){d.add(d.$element.val())}else{p("option",d.$element).each(function(){d.add(p(this).attr("value"),true)})}}},destroy:function(){var a=this;a.$container.off("keypress","input");a.$container.off("click","[role=remove]");a.$container.remove();a.$element.removeData("tagsinput");a.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var a=this.$input[0],b=this.$container[0];while(a&&a.parentNode!==b){a=a.parentNode}return p(a)}};p.fn.tagsinput=function(b,c,d){var a=[];this.each(function(){var e=p(this).data("tagsinput");if(!e){e=new l(this,b);p(this).data("tagsinput",e);a.push(e);if(this.tagName==="SELECT"){p("option",p(this)).attr("selected","selected")}p(this).val(p(this).val())}else{if(!b&&!c){a.push(e)}else{if(e[b]!==undefined){if(e[b].length===3&&d!==undefined){var f=e[b](c,null,d)}else{var f=e[b](c)}if(f!==undefined){a.push(f)}}}}});if(typeof b=="string"){return a.length>1?a:a[0]}else{return a}};p.fn.tagsinput.Constructor=l;function r(b,a){if(typeof b[a]!=="function"){var c=b[a];b[a]=function(d){return d[c]}}}function k(c,b){if(typeof c[b]!=="function"){var a=c[b];c[b]=function(){return a}}}var j=p("<div />");function m(a){if(a){return j.text(a).html()}else{return""}}function n(b){var a=0;if(document.selection){b.focus();var c=document.selection.createRange();c.moveStart("character",-b.value.length);a=c.text.length}else{if(b.selectionStart||b.selectionStart=="0"){a=b.selectionStart}}return(a)}function o(c,a){var b=false;p.each(a,function(g,h){if(typeof(h)==="number"&&c.which===h){b=true;return false}if(c.which===h.which){var e=!h.hasOwnProperty("altKey")||c.altKey===h.altKey,d=!h.hasOwnProperty("shiftKey")||c.shiftKey===h.shiftKey,f=!h.hasOwnProperty("ctrlKey")||c.ctrlKey===h.ctrlKey;if(e&&d&&f){b=true;return false}}});return b}p(function(){p("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);